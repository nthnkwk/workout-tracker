import { useState, useEffect } from "react";

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T = {
  grad: "linear-gradient(135deg, #6be53d 0%, #22c97a 45%, #0eb8a0 100%)",
  gradSubtle: "linear-gradient(135deg, rgba(107,229,61,0.12) 0%, rgba(14,184,160,0.12) 100%)",
  teal: "#0eb8a0",
  green: "#6be53d",
  mid: "#22c97a",
  dark: "#0a3d35",       // deep dark teal for text accents
  accent: "#0c6b5e",     // mid-dark teal for section labels
  glow: "0 0 32px rgba(34,201,122,0.22), 0 4px 24px rgba(14,184,160,0.15)",
  glowSm: "0 0 16px rgba(34,201,122,0.15)",
};

// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DAYS = {
  A: { label:"Day A", subtitle:"Upper Chest + Lats", exercises:[
    {id:"incline_db",name:"Incline DB Press",range:"4Ã—6â€“8",unit:"kg",tips:["Set bench to 30â€“45Â°. Higher = more shoulder, lower = more chest.","Dumbbells start at shoulder height, elbows at ~60Â° from torso (not flared out).","Press up and slightly together â€” don't lock out hard at top.","Control the descent for 2â€“3 sec. Feel the stretch at the bottom.","Stop 1â€“2 reps before form breaks â€” no ugly grinding."]},
    {id:"pullups",name:"Pull-Ups",range:"4Ã—5â€“8",unit:"BW",tips:["Dead hang start â€” full arm extension, shoulders packed down.","Drive elbows toward your back pockets, not just down.","Chin clears bar = full rep. Don't crane your neck up.","Lower slowly (2â€“3 sec) â€” the descent builds more muscle.","If stuck at low reps: use a band or do 3-sec negatives only."]},
    {id:"cs_row",name:"Chest Supported Row",range:"3Ã—8â€“10",unit:"kg",tips:["Lie chest-down on the incline pad â€” let your arms hang freely.","Row to your lower chest/upper stomach, not your chin.","Squeeze shoulder blades together at the top, hold 1 sec.","Elbows should travel at ~45Â° from body â€” not straight out.","Keep your chest pinned to the pad throughout. No heaving."]},
    {id:"ohp",name:"Seated DB Shoulder Press",range:"3Ã—8â€“10",unit:"kg",tips:["Sit upright with back support. Don't arch aggressively.","Start with DBs at ear height, palms facing forward.","Press straight up â€” DBs can touch lightly at top.","Don't lock out and rest â€” keep tension on the delts.","If shoulders feel cooked from yoga, drop weight 10â€“15% guilt-free."]},
    {id:"cable_lat",name:"Cable Lateral Raise",range:"4Ã—12â€“15",unit:"kg",tips:["Cable pulled across the body gives better tension at the bottom.","Lead with your elbow, not your hand â€” think 'pour a jug'.","Raise to shoulder height only. Higher = traps, not delts.","Use a slow 3-sec lower â€” that's where the growth is.","Lighter weight done properly beats heavy and sloppy every time."]},
    {id:"face_pull",name:"Face Pull",range:"3Ã—15",unit:"kg",tips:["Set cable at upper-chest to face height with rope attachment.","Pull toward your forehead, flaring elbows high and wide.","Think: 'show your armpits' at the end of each rep.","Slow and controlled â€” this is shoulder health work, not ego lifting.","Light weight, high reps. Never rush this one."]},
  ], core:["Dead Bug â€” 3Ã—8/side","Pallof Press â€” 3Ã—10/side"] },
  B: { label:"Day B", subtitle:"Delts + Back Thickness", exercises:[
    {id:"flat_db",name:"Flat DB Press",range:"4Ã—6â€“8",unit:"kg",tips:["Lie flat, feet planted. DBs start at chest height.","Elbows at 45â€“60Â° from body â€” not flared like a chicken.","Press explosively up, control slowly down.","Slight arch in lower back is fine. Ribs up, not flattened.","Touch DBs lightly at top but don't clang and bounce."]},
    {id:"lat_pd",name:"Lat Pulldown",range:"4Ã—8â€“10",unit:"kg",tips:["Grip slightly wider than shoulder width. Lean back ~15Â°.","Pull bar to upper chest â€” not behind the neck.","Lead with elbows driving down and back.","Squeeze lats hard at bottom, then control the rise.","Avoid using momentum â€” if you're swinging, the weight's too heavy."]},
    {id:"sa_row",name:"Single Arm DB Row",range:"3Ã—8â€“10",unit:"kg",tips:["Brace one hand and same-side knee on a bench.","Back stays flat and parallel to the floor â€” no rotation.","Pull DB to your hip, not your armpit.","Think: elbow back and up, like starting a lawnmower.","Full stretch at the bottom â€” let the lat lengthen before pulling."]},
    {id:"rear_delt",name:"Rear Delt Fly",range:"4Ã—12â€“15",unit:"kg",tips:["Hinge forward to ~45Â° or lie face-down on incline bench.","Arms slightly bent, raise out to the sides like wings.","Lead with your elbows â€” not your hands.","Squeeze rear delts at top. These are small muscles â€” go light.","Slow and controlled. 2 sec up, 3 sec down."]},
    {id:"lat_drop",name:"Lateral Raise Drop Set",range:"3 rounds",unit:"kg",tips:["Start at a weight you can do 12 clean reps.","When form breaks, immediately drop 2â€“4kg and continue.","3 drops per round = one brutal but effective set.","Keep the 'pour a jug' elbow-lead technique throughout.","Rest 90 sec between rounds â€” these will burn."]},
    {id:"leg_press",name:"Leg Press",range:"2â€“3Ã—8â€“10",unit:"kg",tips:["Feet shoulder-width, mid-height on the platform.","Lower until knees reach ~90Â° â€” don't let lower back peel off.","Press through your heels, not your toes.","Don't lock out knees at the top â€” keep tension on quads.","Controlled descent always. Don't let the sled drop."]},
  ], core:["Hanging Knee Raises â€” 3Ã—8â€“12","Cable Crunch / Ab Wheel â€” 3Ã—10â€“12"] },
  C: { label:"Day C", subtitle:"Lower Bias (optional)", exercises:[
    {id:"rdl",name:"Romanian Deadlift",range:"4Ã—6â€“8",unit:"kg",tips:["Stand hip-width, soft bend in knees â€” keep them fixed.","Push hips back (not down) as you lower the bar.","Bar stays close to your legs the whole way down.","Feel a deep hamstring stretch at the bottom â€” that's the goal.","Drive hips forward to stand. Squeeze glutes at top."]},
    {id:"bss",name:"Bulgarian Split Squat",range:"3Ã—8/side",unit:"kg",tips:["Rear foot elevated on bench, front foot far enough forward.","Lower straight down â€” don't let front knee cave inward.","Front shin stays relatively vertical for more glute work.","Hold DBs at sides or use goblet position for balance.","Go slow on the way down. These will humble you."]},
    {id:"hip_thrust",name:"Hip Thrust",range:"3Ã—8â€“10",unit:"kg",tips:["Upper back on bench edge, bar or DB across hip crease.","Feet shoulder-width, toes slightly out.","Drive through heels â€” squeeze glutes HARD at the top.","Full hip extension at top. Don't just go halfway.","Control the descent. Don't let hips crash down."]},
    {id:"leg_curl",name:"Leg Curl",range:"3Ã—10â€“12",unit:"kg",tips:["Lie face down, keep hips pressed into the pad.","Curl heels to glutes â€” pause at top for 1 sec.","Lower slowly â€” 3 sec descent is where hamstrings grow.","Don't let your hips rise off the pad to cheat reps.","Last set can go close to failure â€” isolation is more forgiving."]},
    {id:"calf",name:"Calf Raises",range:"3Ã—12â€“15",unit:"kg",tips:["Full range: deep stretch at bottom, full rise at top.","Pause 1 sec at top, 2 sec at bottom for best results.","Single-leg version makes this much harder â€” worth trying.","Calves are stubborn â€” squeeze hard and go slow.","Weighted or bodyweight on a step both work well."]},
    {id:"farmer",name:"Farmer Carries",range:"3 rounds",unit:"kg",tips:["Pick a challenging but manageable weight in each hand.","Walk tall â€” chest up, shoulders packed down and back.","Short, controlled steps. Don't waddle side to side.","Grip is the limiter â€” that's the point. Let it burn.","~30m per round is a good target. Rest 60 sec between."]},
  ], core:[] },
};

const BENCHMARKS = {
  pullups:{label:"Pull-Ups",start:3,target:9,unit:"reps"},
  incline_db:{label:"Incline DB Press",start:22,target:40,unit:"kg"},
  ohp:{label:"OHP (per side)",start:12.5,target:20,unit:"kg"},
};

const MEALS = [
  {id:"morning",emoji:"ğŸŒ…",label:"Morning",desc:"Greek yogurt + fruit + nuts"},
  {id:"lunch",emoji:"ğŸ¥—",label:"Lunch",desc:"Veg-heavy + tofu / chicken / eggs"},
  {id:"postworkout",emoji:"ğŸ’ª",label:"Post-Workout",desc:"WPI shake + banana"},
  {id:"dinner",emoji:"ğŸ½ï¸",label:"Dinner",desc:"Carb + protein + veg"},
  {id:"bedtime",emoji:"ğŸŒ™",label:"Before Bed",desc:"Cottage cheese or yogurt (optional)"},
];

const NONNEG = [
  {id:"protein",emoji:"ğŸ¥©",label:"Protein",target:"130g today",colour:"#ef4444"},
  {id:"creatine",emoji:"âš¡",label:"Creatine",target:"5g daily",colour:"#8b5cf6"},
  {id:"water",emoji:"ğŸ’§",label:"Water",target:"2.5â€“3L today",colour:T.teal},
];

const DEFAULT_HISTORY = {
  incline_db:[{w:22,r:6},{w:22,r:7},{w:22,r:8},{w:24,r:6}],
  pullups:[{w:0,r:3},{w:0,r:4},{w:0,r:4},{w:0,r:5}],
  cs_row:[{w:18,r:8},{w:18,r:9}], ohp:[{w:12.5,r:8},{w:12.5,r:9},{w:12.5,r:10}],
  cable_lat:[{w:8,r:12},{w:8,r:14}], face_pull:[{w:12,r:15}],
  flat_db:[{w:25,r:7},{w:25,r:8}], lat_pd:[{w:40,r:8},{w:40,r:10},{w:45,r:8}],
  sa_row:[{w:20,r:9}], rear_delt:[{w:8,r:12}], lat_drop:[{w:8,r:12}],
  leg_press:[{w:60,r:8},{w:60,r:10}], rdl:[{w:40,r:6},{w:40,r:8}],
  bss:[{w:16,r:8}], hip_thrust:[{w:40,r:8}], leg_curl:[{w:25,r:10}],
  calf:[{w:30,r:12}], farmer:[{w:20,r:0}],
};

const SK = {
  history:"wt_history", week:"wt_week", shoulder:"wt_shoulder",
  bw:"wt_bw", completed:"wt_completed",
  nutDate:"wt_nut_date", nutChecks:"wt_nut_checks", mealChecks:"wt_meal_checks",
  lastAutoWeek:"wt_last_auto_week",
};

async function load(key, fallback) {
  try { const r = await window.storage.get(key); return r ? JSON.parse(r.value) : fallback; }
  catch { return fallback; }
}
async function save(key, val) { try { await window.storage.set(key, JSON.stringify(val)); } catch {} }
const todayStr = () => new Date().toISOString().slice(0,10);

// â”€â”€ SUBCOMPONENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const Sparkline = ({ data }) => {
  if (!data || data.length < 2) return <span style={{fontSize:11,color:"#999"}}>Not enough data</span>;
  const vals = data.map(d => d.r || d.w);
  const mn = Math.min(...vals), mx = Math.max(...vals), rng = mx-mn||1;
  const W=80,H=28;
  const pts = vals.map((v,i)=>`${(i/(vals.length-1))*W},${H-((v-mn)/rng)*(H-4)-2}`).join(" ");
  const up = vals[vals.length-1]>=vals[0];
  return (
    <svg width={W} height={H}>
      <polyline points={pts} fill="none" stroke={up?T.mid:"#ef4444"} strokeWidth={2} strokeLinejoin="round"/>
      {vals.map((v,i)=><circle key={i} cx={(i/(vals.length-1))*W} cy={H-((v-mn)/rng)*(H-4)-2} r={2.5} fill={up?T.mid:"#ef4444"}/>)}
    </svg>
  );
};

const PBar = ({value,max,gradient=false}) => (
  <div style={{background:"#f0f0f0",borderRadius:99,height:6,overflow:"hidden"}}>
    <div style={{width:`${Math.min((value/max)*100,100)}%`,height:"100%",background:gradient?T.grad:T.teal,borderRadius:99,transition:"width 0.4s"}}/>
  </div>
);

const SectionLabel = ({children,style={}}) => (
  <div style={{fontSize:12,fontWeight:700,color:T.accent,textTransform:"uppercase",letterSpacing:0.8,marginBottom:12,...style}}>{children}</div>
);

// â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export default function App() {
  const [ready,setReady] = useState(false);
  const [view,setView] = useState("home");
  const [activeDay,setActiveDay] = useState(null);
  const [logSheet,setLogSheet] = useState(null);
  const [tipsSheet,setTipsSheet] = useState(null);
  const [history,setHistory] = useState(DEFAULT_HISTORY);
  const [sessionLogs,setSessionLogs] = useState({});
  const [shoulderFlag,setShoulderFlag] = useState(false);
  const [weekNum,setWeekNum] = useState(3);
  const [bodyweight,setBodyweight] = useState([70.8,71.0,71.1]);
  const [bwInput,setBwInput] = useState("");
  const [chartEx,setChartEx] = useState(null);
  const [completed,setCompleted] = useState({A:false,B:false,C:false});
  const [nutChecks,setNutChecks] = useState({protein:false,creatine:false,water:false});
  const [mealChecks,setMealChecks] = useState({});

  const isDeload = weekNum===7;
  const hr = new Date().getHours();
  const mn = new Date().getMinutes();
  const timeVal = hr + mn/60;
  const isEvening = hr>=17;

  const greeting = (() => {
    if (timeVal>=8 && timeVal<11.5) return "Good morning ğŸ‘‹ğŸ¼";
    if (timeVal>=11.5 && timeVal<13) return "Lunch ğŸ½ï¸";
    if (timeVal>=13 && timeVal<17) return "Good afternoon ğŸ™ŒğŸ¼";
    if (timeVal>=17 && timeVal<24) return "Good evening ğŸ™‚â€â†•ï¸";
    if (timeVal>=0 && timeVal<5) return "Hey nightowl ğŸ¦‰";
    return "Hey earlybird ğŸ¦†";
  })();

  const MOTTOS = ["Start before you feel ready.","Today counts. Begin.","One set is enough to start.","Show up. That's the win.","Begin messy. Improve later.","Five minutes. That's all you need.","Start small. Stay consistent.","Action creates motivation.","Put your shoes on. Go.","The first rep changes everything.","You don't need perfect conditions.","Just walk into the gym.","Start tired. Finish proud.","Today is a good day to begin.","One workout ahead of regret.","Don't think. Do the warm-up.","Start now. Adjust later.","Momentum loves starters.","Begin with one clean rep.","The door is the hardest part.","Show up imperfect.","Your future self votes today.","Build the habit. Not the mood.","Start light. Stay steady.","A short session still counts.","Start where you are.","Action over analysis.","The plan works when you begin.","Today's effort compounds.","Just press record on the habit.","First rep. No drama.","Don't wait for motivation. Create it.","Ten minutes beats zero.","Start quietly.","Begin with breath and movement.","One decision. That's all.","Turn up for yourself today.","Make today a training day.","Start before doubt speaks.","Small action. Big trajectory.","Move your body. Clear your mind.","The warm-up is the gateway.","Start with what you can do.","Done is better than delayed.","You only need to begin.","Lace up. That's step one.","Start now. Thank yourself later.","Begin again if you must.","Today is for showing up."];
  const [motto] = useState(()=>MOTTOS[Math.floor(Math.random()*MOTTOS.length)]);

  const WEEK_GRADS = {
    1:"linear-gradient(315deg,#a8ed6a,#2dd4a0)",
    2:"linear-gradient(315deg,#96e84a,#1fc99a)",
    3:"linear-gradient(315deg,#7de02a,#18bc8e)",
    4:"linear-gradient(315deg,#5ed800,#12a87e)",
    5:"linear-gradient(315deg,#44cc00,#0e9870)",
    6:"linear-gradient(315deg,#2ebd00,#0a8862)",
    7:"linear-gradient(315deg,#fde68a,#fbbf24)",
  };
  const phaseGrad = WEEK_GRADS[weekNum] || WEEK_GRADS[1];
  const phaseGradFinal = phaseGrad;
  const phaseLabel = isDeload?"Deload":weekNum<=3?"Add Reps":"Add Weight";
  const weekTextLight = weekNum <= 3;
  const wTxt = weekTextLight ? "rgba(10,60,40,0.9)" : "#fff";
  const wTxtMuted = weekTextLight ? "rgba(10,60,40,0.55)" : "rgba(255,255,255,0.7)";

  const weightStalled = (() => {
    if(bodyweight.length<4) return false;
    const r=bodyweight.slice(-4);
    return r[r.length-1]-r[0]<0.1;
  })();

  const nutDone = Object.values(nutChecks).filter(Boolean).length;
  const mealDone = Object.values(mealChecks).filter(Boolean).length;

  useEffect(()=>{
    (async()=>{
      const [h,w,s,bw,c,nd,nc,mc,law] = await Promise.all([
        load(SK.history,DEFAULT_HISTORY), load(SK.week,1), load(SK.shoulder,false),
        load(SK.bw,[70.8,71.0,71.1]), load(SK.completed,{A:false,B:false,C:false}),
        load(SK.nutDate,todayStr()), load(SK.nutChecks,{protein:false,creatine:false,water:false}),
        load(SK.mealChecks,{}), load(SK.lastAutoWeek, null),
      ]);
      const today = todayStr();
      const now = new Date();
      // Auto-advance week at 12:01am every Sunday (day=0)
      const isSunday = now.getDay() === 0;
      const pastMidnight = now.getHours() === 0 && now.getMinutes() >= 1;
      const thisSundayStr = today;
      let resolvedWeek = w;
      if (isSunday && pastMidnight && law !== thisSundayStr && w < 7) {
        resolvedWeek = w + 1;
        save(SK.week, resolvedWeek);
        save(SK.lastAutoWeek, thisSundayStr);
        save(SK.completed, {A:false,B:false,C:false});
      }
      setHistory(h); setWeekNum(resolvedWeek); setShoulderFlag(s); setBodyweight(bw);
      setCompleted(law !== thisSundayStr && isSunday && pastMidnight ? {A:false,B:false,C:false} : c);
      if(nd!==today){
        setNutChecks({protein:false,creatine:false,water:false}); setMealChecks({});
        save(SK.nutDate,today); save(SK.nutChecks,{protein:false,creatine:false,water:false}); save(SK.mealChecks,{});
      } else { setNutChecks(nc); setMealChecks(mc); }
      setReady(true);
    })();
  },[]);

  const ph = (key,val,setter) => { setter(val); save(key,val); };
  const getLastLog = id => { const h=history[id]; return h?.length?h[h.length-1]:{w:0,r:0}; };
  const getPreFill = id => { const l=getLastLog(id); return isDeload?{w:Math.round(l.w*0.8*2)/2,r:l.r}:l; };

  const openLog = (dayKey,exIdx) => {
    const ex=DAYS[dayKey].exercises[exIdx], pre=getPreFill(ex.id);
    setSessionLogs(p=>({...p,[ex.id]:p[ex.id]||{w:pre.w,r:pre.r}}));
    setLogSheet({dayKey,exIdx});
  };

  const saveLog = () => {
    const ex=DAYS[logSheet.dayKey].exercises[logSheet.exIdx], entry=sessionLogs[ex.id];
    if(entry){ const h={...history,[ex.id]:[...(history[ex.id]||[]),{w:Number(entry.w),r:Number(entry.r)}]}; ph(SK.history,h,setHistory); }
    setLogSheet(null);
  };

  const finishSession = key => { const c={...completed,[key]:true}; ph(SK.completed,c,setCompleted); setActiveDay(null); setView("home"); };
  const allEx = Object.values(DAYS).flatMap(d=>d.exercises);

  if(!ready) return (
    <div style={{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"-apple-system,sans-serif"}}>
      <div style={{textAlign:"center"}}>
        <div style={{fontSize:40,marginBottom:12,filter:`drop-shadow(${T.glowSm})`}}>ğŸ’ª</div>
        <div style={{fontSize:14,color:T.accent,fontWeight:600}}>Loading your dataâ€¦</div>
      </div>
    </div>
  );

  // â”€â”€ SHEETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const TipsSheet = () => {
    if(!tipsSheet) return null;
    return (
      <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:200,display:"flex",alignItems:"flex-end"}}>
        <div style={{background:"#fff",width:"100%",borderRadius:"20px 20px 0 0",padding:"24px 20px 48px",maxHeight:"75vh",overflowY:"auto"}}>
          <div style={{width:36,height:4,background:"#ddd",borderRadius:99,margin:"0 auto 20px"}}/>
          <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:18}}>
            <div style={{width:40,height:40,borderRadius:12,background:T.gradSubtle,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,border:`1.5px solid rgba(14,184,160,0.2)`}}>ğŸ’¡</div>
            <div><div style={{fontSize:17,fontWeight:800,color:T.dark}}>{tipsSheet.name}</div><div style={{fontSize:12,color:"#888"}}>Form & technique tips</div></div>
          </div>
          {tipsSheet.tips.map((tip,i)=>(
            <div key={i} style={{display:"flex",gap:12,marginBottom:14,alignItems:"flex-start"}}>
              <div style={{background:T.grad,borderRadius:99,width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800,flexShrink:0,marginTop:1,color:"#fff"}}>{i+1}</div>
              <div style={{fontSize:14,color:"#333",lineHeight:1.5}}>{tip}</div>
            </div>
          ))}
          <button onClick={()=>setTipsSheet(null)} style={{width:"100%",background:T.grad,color:"#fff",border:"none",borderRadius:14,padding:"16px",fontSize:15,fontWeight:800,cursor:"pointer",boxShadow:T.glowSm,marginTop:8}}>Got it âœ“</button>
        </div>
      </div>
    );
  };

  const LogSheet = () => {
    if(!logSheet) return null;
    const ex=DAYS[logSheet.dayKey].exercises[logSheet.exIdx];
    const log=sessionLogs[ex.id]||{w:0,r:0}, last=getLastLog(ex.id), isBW=ex.unit==="BW";
    const adj=(field,delta)=>setSessionLogs(p=>({...p,[ex.id]:{...p[ex.id],[field]:Math.max(0,Number(p[ex.id]?.[field]||0)+delta)}}));
    return (
      <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",zIndex:100,display:"flex",alignItems:"flex-end"}}>
        <div style={{background:"#fff",width:"100%",borderRadius:"20px 20px 0 0",padding:"24px 20px 40px"}}>
          <div style={{width:36,height:4,background:"#ddd",borderRadius:99,margin:"0 auto 20px"}}/>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}>
            <div>
              <div style={{fontSize:18,fontWeight:700,color:T.dark}}>{ex.name}</div>
              <div style={{fontSize:13,color:"#888",marginTop:2}}>
                {ex.range} Â· Last: {isBW?`BWÃ—${last.r}`:`${last.w}kgÃ—${last.r}`}
                {isDeload&&<span style={{color:"#f59e0b",fontWeight:700}}> Â· ğŸ”„ 80%</span>}
              </div>
            </div>
            <button onClick={()=>{setLogSheet(null);setTipsSheet(ex);}} style={{background:T.gradSubtle,border:`1.5px solid rgba(14,184,160,0.25)`,borderRadius:10,padding:"6px 12px",fontSize:12,fontWeight:700,cursor:"pointer",color:T.accent}}>ğŸ’¡ Tips</button>
          </div>
          {isDeload&&<div style={{background:"#fff8e6",border:"1px solid #f59e0b",borderRadius:10,padding:"8px 12px",marginTop:10,fontSize:12,color:"#92400e"}}>ğŸ”„ Deload â€” weight auto-set to 80%. Cut sets in half.</div>}
          {!isBW&&(
            <div style={{marginTop:18,marginBottom:20}}>
              <div style={{fontSize:12,color:T.accent,fontWeight:700,marginBottom:10,textTransform:"uppercase",letterSpacing:0.5}}>Weight (kg)</div>
              <div style={{display:"flex",alignItems:"center",gap:16}}>
                <button onClick={()=>adj("w",-1)} style={{background:"#f4f4f4",color:"#333",border:"none",borderRadius:12,padding:"12px 20px",fontSize:15,fontWeight:700,cursor:"pointer",minWidth:56}}>âˆ’1</button>
                <div style={{fontSize:32,fontWeight:800,flex:1,textAlign:"center",color:T.dark}}>{log.w}</div>
                <button onClick={()=>adj("w",1)} style={{background:T.grad,color:"#fff",border:"none",borderRadius:12,padding:"12px 20px",fontSize:15,fontWeight:700,cursor:"pointer",minWidth:56}}>+1</button>
              </div>
            </div>
          )}
          <div style={{marginBottom:28}}>
            <div style={{fontSize:12,color:T.accent,fontWeight:700,marginBottom:10,textTransform:"uppercase",letterSpacing:0.5}}>Top Set Reps</div>
            <div style={{display:"flex",alignItems:"center",gap:16}}>
              <button onClick={()=>adj("r",-1)} style={{background:"#f4f4f4",color:"#333",border:"none",borderRadius:12,padding:"12px 20px",fontSize:15,fontWeight:700,cursor:"pointer",minWidth:56}}>âˆ’1</button>
              <div style={{fontSize:32,fontWeight:800,flex:1,textAlign:"center",color:T.dark}}>{log.r}</div>
              <button onClick={()=>adj("r",1)} style={{background:T.grad,color:"#fff",border:"none",borderRadius:12,padding:"12px 20px",fontSize:15,fontWeight:700,cursor:"pointer",minWidth:56}}>+1</button>
            </div>
          </div>
          <button onClick={saveLog} style={{width:"100%",background:T.grad,color:"#fff",border:"none",borderRadius:14,padding:"16px",fontSize:16,fontWeight:800,cursor:"pointer",boxShadow:T.glowSm}}>Log Top Set âœ“</button>
          <button onClick={()=>setLogSheet(null)} style={{width:"100%",padding:"12px",fontSize:14,color:"#888",background:"none",border:"none",marginTop:8,cursor:"pointer"}}>Cancel</button>
        </div>
      </div>
    );
  };

  // â”€â”€ HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const HomeView = () => (
    <div style={{padding:"0 20px 100px"}}>
      <div style={{paddingTop:56,marginBottom:24}}>
        <div style={{fontSize:26,fontWeight:800,letterSpacing:-0.5,color:T.dark}}>{greeting}</div>
        <div style={{fontSize:14,color:"#888",marginTop:4}}>{motto}</div>
      </div>

      {/* Week wave â€” gradient + subtle glow */}
      <div style={{background:phaseGrad,borderRadius:22,padding:"20px 20px 18px",marginBottom:20,color:"#fff",boxShadow:T.glow,position:"relative",overflow:"hidden"}}>
        <div style={{position:"absolute",top:-30,right:-30,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)",pointerEvents:"none"}}/>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
          <div>
            <div style={{fontSize:11,color:"rgba(255,255,255,0.7)",textTransform:"uppercase",letterSpacing:0.8}}>Training Wave</div>
            <div style={{fontSize:22,fontWeight:800,marginTop:2}}>Week {weekNum} / 7</div>
          </div>
          <div style={{display:"flex",gap:8,alignItems:"center"}}>
            <div style={{background:"rgba(255,255,255,0.22)",backdropFilter:"blur(8px)",borderRadius:99,padding:"6px 16px",fontSize:12,fontWeight:700}}>{phaseLabel}</div>
            <button onClick={()=>ph(SK.week,1,setWeekNum)} style={{background:"rgba(255,255,255,0.18)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.35)",borderRadius:99,padding:"6px 12px",fontSize:11,fontWeight:700,color:"#fff",cursor:"pointer"}}>â†º Reset</button>
          </div>

        </div>
        <div style={{display:"flex",gap:6}}>
          {[1,2,3,4,5,6,7].map(w=>(
            <div key={w} onClick={()=>ph(SK.week,w,setWeekNum)} style={{flex:1,height:8,borderRadius:99,cursor:"pointer",background:w<weekNum?"rgba(255,255,255,0.9)":w===weekNum?"rgba(255,255,255,0.55)":"rgba(255,255,255,0.2)",transition:"background 0.2s"}}/>
          ))}
        </div>
        <div style={{fontSize:11,color:"rgba(255,255,255,0.7)",marginTop:10}}>
          {isDeload?"ğŸ”„ Deload â€” 80% weight, half sets.":weekNum<=3?"ğŸ“ˆ Add reps within range":"ğŸ“ˆ Increase weight once at top of range"}
        </div>
      </div>

      {/* Shoulder alert */}
      <div style={{borderRadius:16,padding:"14px 16px",marginBottom:14,background:shoulderFlag?"#fff3cd":"#f8f8f8",border:`1px solid ${shoulderFlag?"#f59e0b":"#eee"}`,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div>
          <div style={{fontSize:13,fontWeight:700,color:shoulderFlag?"#92400e":T.dark}}>{shoulderFlag?"âš ï¸ Shoulder Fatigue Flagged":"ğŸ‹ï¸ Shoulders feeling good"}</div>
          <div style={{fontSize:12,color:"#888",marginTop:2}}>{shoulderFlag?"Reduce pressing sets by 1 this week":"Tap to flag fatigue"}</div>
        </div>
        <div onClick={()=>ph(SK.shoulder,!shoulderFlag,setShoulderFlag)} style={{width:44,height:26,borderRadius:99,cursor:"pointer",background:shoulderFlag?"#f59e0b":T.teal,position:"relative",transition:"background 0.2s",boxShadow:shoulderFlag?"none":T.glowSm}}>
          <div style={{width:20,height:20,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:shoulderFlag?21:3,transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}/>
        </div>
      </div>

      {/* Nutrition preview */}
      <div onClick={()=>setView("nutrition")} style={{borderRadius:16,padding:"14px 16px",marginBottom:14,background:nutDone===3?T.gradSubtle:"#f8f8f8",border:`1.5px solid ${nutDone===3?"rgba(14,184,160,0.3)":"#eee"}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div>
          <div style={{fontSize:13,fontWeight:700,color:T.dark}}>ğŸ¥— Today's Nutrition</div>
          <div style={{fontSize:12,color:"#888",marginTop:2}}>{nutDone}/3 non-negotiables Â· {mealDone}/5 meals</div>
        </div>
        <div style={{display:"flex",gap:6}}>
          {NONNEG.map(n=><div key={n.id} style={{width:10,height:10,borderRadius:"50%",background:nutChecks[n.id]?n.colour:"#ddd",boxShadow:nutChecks[n.id]?`0 0 6px ${n.colour}66`:""}}/>)}
        </div>
      </div>

      {/* Deload week â€” replaces day cards */}
      {isDeload ? (
        <div>
          <SectionLabel>Deload Week ğŸ”„</SectionLabel>

          {/* Why it matters */}
          <div style={{background:T.gradSubtle,border:`1.5px solid rgba(14,184,160,0.2)`,borderRadius:18,padding:"16px 18px",marginBottom:14}}>
            <div style={{fontSize:15,fontWeight:800,color:T.dark,marginBottom:6}}>Why this week matters</div>
            <div style={{fontSize:13,color:"#555",lineHeight:1.6}}>Your muscles grow during recovery, not during training. This week lets your joints, tendons, and nervous system catch up â€” so you come back to Week 1 stronger, not just fresher. Don't skip it.</div>
          </div>

          {/* Per-day deload cards */}
          {[
            { label:"Day A", subtitle:"Upper Chest + Lats", exercises:[
              {name:"Incline DB Press", adj:"80% weight Â· 2 sets"},
              {name:"Pull-Ups", adj:"80% effort Â· 2 sets â€” stop well short of failure"},
              {name:"Chest Supported Row", adj:"80% weight Â· 2 sets"},
              {name:"Seated DB Shoulder Press", adj:"80% weight Â· 2 sets"},
              {name:"Cable Lateral Raise", adj:"Light Â· 2 sets â€” focus on feel"},
              {name:"Face Pull", adj:"Light Â· 2 sets â€” shoulder health priority"},
            ], core:"Keep Dead Bug + Pallof Press â€” full sets, clean reps"},
            { label:"Day B", subtitle:"Delts + Back Thickness", exercises:[
              {name:"Flat DB Press", adj:"80% weight Â· 2 sets"},
              {name:"Lat Pulldown", adj:"80% weight Â· 2 sets"},
              {name:"Single Arm DB Row", adj:"80% weight Â· 2 sets"},
              {name:"Rear Delt Fly", adj:"Light Â· 2 sets"},
              {name:"Lateral Raise", adj:"Light only Â· 2 sets â€” no drop set this week"},
              {name:"Leg Press", adj:"80% weight Â· 2 sets"},
            ], core:"Keep Hanging Knee Raises + Ab Wheel â€” full sets"},
            { label:"Day C", subtitle:"Lower Bias (optional â€” skip if fatigued)", optional:true, exercises:[
              {name:"Romanian Deadlift", adj:"80% weight Â· 2 sets"},
              {name:"Bulgarian Split Squat", adj:"80% weight Â· 2 sets"},
              {name:"Hip Thrust", adj:"80% weight Â· 2 sets"},
              {name:"Leg Curl", adj:"80% weight Â· 2 sets"},
              {name:"Calf Raises", adj:"Bodyweight or light Â· 2 sets"},
              {name:"Farmer Carries", adj:"Skip this week â€” grip/CNS recovery"},
            ], core:null},
          ].map((day,di)=>(
            <div key={di} style={{background:"#fff",border:`1.5px solid #eee`,borderRadius:18,padding:"16px 18px",marginBottom:12}}>
              <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
                <div style={{fontSize:15,fontWeight:800,color:T.dark}}>{day.label}</div>
                {day.optional&&<span style={{fontSize:10,background:"#f0f0f0",borderRadius:6,padding:"2px 7px",fontWeight:600,color:"#888"}}>OPTIONAL</span>}
                <span style={{fontSize:10,background:"#fff3cd",borderRadius:6,padding:"2px 7px",fontWeight:600,color:"#92400e"}}>ğŸ”„ DELOAD</span>
              </div>
              <div style={{fontSize:12,color:"#888",marginBottom:10}}>{day.subtitle}</div>
              {day.exercises.map((ex,ei)=>(
                <div key={ei} style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",paddingBottom:7,marginBottom:7,borderBottom:ei<day.exercises.length-1?"1px solid #f4f4f4":"none"}}>
                  <div style={{fontSize:13,fontWeight:600,color:T.dark,flex:1}}>{ex.name}</div>
                  <div style={{fontSize:12,color:T.accent,fontWeight:500,textAlign:"right",marginLeft:8}}>{ex.adj}</div>
                </div>
              ))}
              {day.core&&<div style={{marginTop:10,background:T.gradSubtle,borderRadius:10,padding:"8px 12px",fontSize:12,color:T.accent,border:`1px solid rgba(14,184,160,0.15)`}}>ğŸ§˜ {day.core}</div>}
            </div>
          ))}

          {/* Reset prompt */}
          <div style={{background:"#f8f8f8",borderRadius:16,padding:"14px 18px",marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
            <div>
              <div style={{fontSize:13,fontWeight:700,color:T.dark}}>Ready to start Wave 2?</div>
              <div style={{fontSize:12,color:"#888",marginTop:2}}>Tap Reset to begin Week 1 fresh.</div>
            </div>
            <button onClick={()=>ph(SK.week,1,setWeekNum)} style={{background:T.grad,color:"#fff",border:"none",borderRadius:12,padding:"10px 18px",fontSize:13,fontWeight:700,cursor:"pointer",boxShadow:T.glowSm,whiteSpace:"nowrap"}}>â†º Reset</button>
          </div>
        </div>
      ) : (
        <div>
      {/* Day cards */}
      <SectionLabel>This Week's Sessions</SectionLabel>
      {Object.entries(DAYS).map(([key,day])=>{
        const done=completed[key];
        return (
          <div key={key} onClick={()=>{setActiveDay(key);setView("session");}}
            style={{background:done?"#f8f8f8":"#fff",border:`1.5px solid ${done?"#e5e5e5":"#e0f7f4"}`,borderRadius:18,padding:"16px 18px",marginBottom:12,cursor:"pointer",boxShadow:done?"none":"0 2px 12px rgba(14,184,160,0.07)"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <div>
                <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:2}}>
                  <span style={{fontSize:16,fontWeight:800,color:T.dark}}>{day.label}</span>
                  {key==="C"&&<span style={{fontSize:10,background:"#f0f0f0",borderRadius:6,padding:"2px 7px",fontWeight:600,color:"#888"}}>OPTIONAL</span>}
                  {done&&<span style={{fontSize:12}}>âœ…</span>}
                  {isDeload&&<span style={{fontSize:10,background:"#fff3cd",borderRadius:6,padding:"2px 7px",fontWeight:600,color:"#92400e"}}>ğŸ”„ DELOAD</span>}
                </div>
                <div style={{fontSize:13,color:"#888"}}>{day.subtitle}</div>
              </div>
              <div style={{width:28,height:28,borderRadius:"50%",background:T.gradSubtle,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,color:T.teal,border:`1.5px solid rgba(14,184,160,0.2)`}}>â€º</div>
            </div>
            <div style={{marginTop:10,display:"flex",flexWrap:"wrap",gap:6}}>
              {day.exercises.slice(0,3).map(ex=>{
                const pre=getPreFill(ex.id);
                return <div key={ex.id} style={{background:T.gradSubtle,borderRadius:8,padding:"4px 10px",fontSize:12,color:T.accent,border:"1px solid rgba(14,184,160,0.15)"}}>{ex.name.split(" ").slice(0,2).join(" ")} Â· {ex.unit==="BW"?`BWÃ—${pre.r}`:`${pre.w}kg`}</div>;
              })}
              {day.exercises.length>3&&<div style={{background:"#f4f4f4",borderRadius:8,padding:"4px 10px",fontSize:12,color:"#aaa"}}>+{day.exercises.length-3} more</div>}
            </div>
          </div>
        );
      })}

      </div>
      )}

      {/* Bodyweight */}
      <div style={{background:"#f8f8f8",borderRadius:18,padding:"16px 18px"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
          <div><div style={{fontSize:14,fontWeight:700,color:T.dark}}>Bodyweight</div><div style={{fontSize:12,color:"#888"}}>Target: +0.1â€“0.2kg/month</div></div>
          <div style={{fontSize:22,fontWeight:800,color:T.dark}}>{bodyweight[bodyweight.length-1]}kg</div>
        </div>
        <Sparkline data={bodyweight.map(w=>({w,r:w}))}/>
        <div style={{display:"flex",gap:8,marginTop:12}}>
          <input value={bwInput} onChange={e=>setBwInput(e.target.value)} placeholder="Log today's weight" type="number"
            style={{flex:1,border:`1.5px solid #e5e5e5`,borderRadius:10,padding:"10px 12px",fontSize:14,outline:"none",fontFamily:"inherit"}}
            onFocus={e=>e.target.style.borderColor=T.teal} onBlur={e=>e.target.style.borderColor="#e5e5e5"}/>
          <button onClick={()=>{if(bwInput){ph(SK.bw,[...bodyweight,parseFloat(bwInput)],setBodyweight);setBwInput("");}}}
            style={{background:T.grad,color:"#fff",border:"none",borderRadius:10,padding:"10px 16px",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:T.glowSm}}>Log</button>
        </div>
      </div>
    </div>
  );

  // â”€â”€ SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const SessionView = () => {
    if(!activeDay) return null;
    const day=DAYS[activeDay];
    const loggedCount=day.exercises.filter(ex=>sessionLogs[ex.id]).length;
    const progress=loggedCount/day.exercises.length;
    return (
      <div style={{padding:"0 20px 100px"}}>
        <div style={{paddingTop:56,marginBottom:20}}>
          <button onClick={()=>setView("home")} style={{background:"none",border:"none",fontSize:14,color:T.accent,cursor:"pointer",padding:0,marginBottom:12,fontWeight:600}}>â† Back</button>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{fontSize:24,fontWeight:800,color:T.dark}}>{day.label}</div>
            {isDeload&&<span style={{fontSize:11,background:"#fff3cd",borderRadius:8,padding:"3px 9px",fontWeight:700,color:"#92400e"}}>ğŸ”„ Deload</span>}
          </div>
          <div style={{fontSize:14,color:"#888"}}>{day.subtitle}</div>
          <div style={{marginTop:12,background:"#f0f0f0",borderRadius:99,height:6}}>
            <div style={{width:`${progress*100}%`,height:"100%",background:T.grad,borderRadius:99,transition:"width 0.3s",boxShadow:progress>0?T.glowSm:""}}/>
          </div>
          <div style={{fontSize:12,color:T.accent,marginTop:6,fontWeight:600}}>{loggedCount} / {day.exercises.length} logged</div>
        </div>

        {shoulderFlag&&(activeDay==="A"||activeDay==="B")&&(
          <div style={{background:"#fff3cd",borderRadius:14,padding:"12px 16px",marginBottom:14,fontSize:13,color:"#92400e"}}>âš ï¸ Shoulder fatigue â€” reduce pressing sets by 1 today</div>
        )}

        {day.exercises.map((ex,i)=>{
          const entry=sessionLogs[ex.id], pre=getPreFill(ex.id), last=getLastLog(ex.id), isBW=ex.unit==="BW";
          const improved=entry&&(Number(entry.r)>last.r||Number(entry.w)>last.w);
          return (
            <div key={ex.id} style={{background:entry?T.gradSubtle:"#fff",border:`1.5px solid ${entry?"rgba(14,184,160,0.35)":"#eee"}`,borderRadius:16,padding:"14px 16px",marginBottom:10,boxShadow:entry?T.glowSm:""}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div style={{flex:1}} onClick={()=>openLog(activeDay,i)}>
                  <div style={{fontSize:15,fontWeight:700,color:T.dark}}>{ex.name}</div>
                  <div style={{fontSize:12,color:"#888",marginTop:2}}>{ex.range}</div>
                  {entry
                    ?<div style={{fontSize:13,color:T.teal,fontWeight:700,marginTop:4}}>{isBW?`BW Ã— ${entry.r} reps`:`${entry.w}kg Ã— ${entry.r} reps`}{improved&&" ğŸ”¥"}</div>
                    :<div style={{fontSize:12,color:"#bbb",marginTop:4}}>Pre-filled: {isBW?`BWÃ—${pre.r}`:`${pre.w}kgÃ—${pre.r}`}{isDeload?" (80%)":""}</div>
                  }
                </div>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                  <button onClick={()=>setTipsSheet(ex)} style={{background:T.gradSubtle,border:`1px solid rgba(14,184,160,0.2)`,borderRadius:10,width:34,height:34,fontSize:15,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>ğŸ’¡</button>
                  <div onClick={()=>openLog(activeDay,i)} style={{width:32,height:32,borderRadius:"50%",background:entry?T.grad:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:14,color:entry?"#fff":"#ccc",boxShadow:entry?T.glowSm:"",fontWeight:800}}>{entry?"âœ“":"+"}</div>
                </div>
              </div>
            </div>
          );
        })}

        {day.core.length>0&&(
          <div style={{background:"#f8f8f8",borderRadius:16,padding:"14px 16px",marginBottom:16}}>
            <SectionLabel style={{marginBottom:8}}>Core</SectionLabel>
            {day.core.map((c,i)=><div key={i} style={{fontSize:13,color:"#555",marginBottom:4}}>â€¢ {c}</div>)}
          </div>
        )}

        <button onClick={()=>finishSession(activeDay)} style={{width:"100%",background:T.grad,color:"#fff",border:"none",borderRadius:16,padding:"18px",fontSize:16,fontWeight:800,cursor:"pointer",boxShadow:T.glow}}>
          Finish Session âœ“
        </button>
      </div>
    );
  };

  // â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const ProgressView = () => (
    <div style={{padding:"0 20px 100px"}}>
      <div style={{paddingTop:56,marginBottom:24}}>
        <div style={{fontSize:26,fontWeight:800,color:T.dark}}>Progress ğŸ“ˆ</div>
        <div style={{fontSize:14,color:"#888"}}>Top set history per exercise</div>
      </div>
      <SectionLabel>12-Month Benchmarks</SectionLabel>
      {Object.entries(BENCHMARKS).map(([id,b])=>{
        const h=history[id]||[], current=h.length?(b.unit==="reps"?h[h.length-1].r:h[h.length-1].w):b.start;
        const pct=Math.round(Math.max(0,((current-b.start)/(b.target-b.start))*100));
        return (
          <div key={id} style={{background:"#f8f8f8",borderRadius:16,padding:"14px 16px",marginBottom:10}}>
            <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
              <div style={{fontSize:14,fontWeight:700,color:T.dark}}>{b.label}</div>
              <div style={{fontSize:13,fontWeight:800,color:T.teal}}>{current} <span style={{color:"#aaa",fontWeight:400}}>/ {b.target} {b.unit}</span></div>
            </div>
            <PBar value={current-b.start} max={b.target-b.start} gradient/>
            <div style={{fontSize:11,color:T.accent,marginTop:6,fontWeight:600}}>{pct}% to goal</div>
          </div>
        );
      })}
      <SectionLabel style={{marginTop:20}}>Exercise History</SectionLabel>
      {allEx.map(ex=>{
        const h=history[ex.id]; if(!h||h.length<2) return null;
        const recent=h.slice(-7);
        const latest=recent[recent.length-1], first=recent[0], up=ex.unit==="BW"?latest.r>first.r:latest.w>first.w||latest.r>first.r;
        return (
          <div key={ex.id} onClick={()=>setChartEx(chartEx===ex.id?null:ex.id)}
            style={{background:"#fff",border:"1.5px solid #eee",borderRadius:16,padding:"14px 16px",marginBottom:10,cursor:"pointer"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <div>
                <div style={{fontSize:14,fontWeight:700,color:T.dark}}>{ex.name}</div>
                <div style={{fontSize:12,color:up?T.teal:"#888",marginTop:2,fontWeight:up?700:400}}>
                  {ex.unit==="BW"?`BWÃ—${latest.r} reps`:`${latest.w}kg Ã— ${latest.r} reps`} {up?"â†‘":""}
                </div>
              </div>
              <Sparkline data={h}/>
            </div>
            {chartEx===ex.id&&(
              <div style={{marginTop:12,display:"flex",gap:6,flexWrap:"wrap"}}>
                {h.map((e,i)=><div key={i} style={{background:T.gradSubtle,borderRadius:8,padding:"4px 10px",fontSize:12,color:T.accent,border:"1px solid rgba(14,184,160,0.15)"}}>#{i+1}: {ex.unit==="BW"?`BWÃ—${e.r}`:`${e.w}kgÃ—${e.r}`}</div>)}
              </div>
            )}
          </div>
        );
      })}
    </div>
  );

  // â”€â”€ NUTRITION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const NutritionView = () => {
    const allNutDone=nutDone===3;
    return (
      <div style={{padding:"0 20px 100px"}}>
        <div style={{paddingTop:56,marginBottom:24}}>
          <div style={{fontSize:26,fontWeight:800,color:T.dark}}>Nutrition ğŸ¥—</div>
          <div style={{fontSize:14,color:"#888"}}>Today's non-negotiables</div>
        </div>

        {isEvening&&!allNutDone&&(
          <div style={{background:"#fff3cd",border:"1px solid #f59e0b",borderRadius:16,padding:"14px 16px",marginBottom:16,display:"flex",gap:10,alignItems:"flex-start"}}>
            <span style={{fontSize:20}}>ğŸŒ™</span>
            <div>
              <div style={{fontSize:13,fontWeight:700,color:"#92400e"}}>Evening reminder</div>
              <div style={{fontSize:12,color:"#92400e",marginTop:2}}>You still have {3-nutDone} non-negotiable{3-nutDone>1?"s":""} to tick off before bed.</div>
            </div>
          </div>
        )}

        {weightStalled&&(
          <div style={{background:"#fef2f2",border:"1px solid #fca5a5",borderRadius:16,padding:"14px 16px",marginBottom:16,display:"flex",gap:10,alignItems:"flex-start"}}>
            <span style={{fontSize:20}}>âš ï¸</span>
            <div>
              <div style={{fontSize:13,fontWeight:700,color:"#991b1b"}}>Weight stall detected</div>
              <div style={{fontSize:12,color:"#991b1b",marginTop:2}}>No meaningful gain across your last 4 weigh-ins. Per your plan: add ~150 calories daily.</div>
            </div>
          </div>
        )}

        <SectionLabel>Non-Negotiables</SectionLabel>
        {NONNEG.map(n=>{
          const done=nutChecks[n.id];
          return (
            <div key={n.id} onClick={()=>{const u={...nutChecks,[n.id]:!done};ph(SK.nutChecks,u,setNutChecks);}}
              style={{background:done?T.gradSubtle:"#fff",border:`1.5px solid ${done?"rgba(14,184,160,0.3)":"#eee"}`,borderRadius:16,padding:"16px 18px",marginBottom:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:done?T.glowSm:""}}>
              <div style={{display:"flex",alignItems:"center",gap:14}}>
                <div style={{width:44,height:44,borderRadius:14,background:done?T.gradSubtle:"#f8f8f8",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,border:`2px solid ${done?T.teal:"#eee"}`}}>{n.emoji}</div>
                <div>
                  <div style={{fontSize:15,fontWeight:700,color:T.dark}}>{n.label}</div>
                  <div style={{fontSize:13,color:"#888",marginTop:2}}>{n.target}</div>
                </div>
              </div>
              <div style={{width:28,height:28,borderRadius:"50%",background:done?T.grad:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,color:"#fff",boxShadow:done?T.glowSm:""}}>{done?"âœ“":""}</div>
            </div>
          );
        })}

        {allNutDone&&<div style={{background:T.gradSubtle,border:`1px solid rgba(14,184,160,0.25)`,borderRadius:14,padding:"12px 16px",marginBottom:20,textAlign:"center",fontSize:14,fontWeight:700,color:T.teal}}>ğŸ‰ All non-negotiables done today!</div>}

        <SectionLabel style={{marginTop:8}}>Meal Timing</SectionLabel>
        {MEALS.map(meal=>{
          const done=mealChecks[meal.id];
          return (
            <div key={meal.id} onClick={()=>{const u={...mealChecks,[meal.id]:!done};ph(SK.mealChecks,u,setMealChecks);}}
              style={{background:done?"#f8f8f8":"#fff",border:"1.5px solid #eee",borderRadius:14,padding:"13px 16px",marginBottom:8,cursor:"pointer",display:"flex",alignItems:"center",gap:14}}>
              <span style={{fontSize:22,opacity:done?0.5:1}}>{meal.emoji}</span>
              <div style={{flex:1}}>
                <div style={{fontSize:14,fontWeight:700,textDecoration:done?"line-through":"none",color:done?"#aaa":T.dark}}>{meal.label}</div>
                <div style={{fontSize:12,color:"#aaa",marginTop:2}}>{meal.desc}</div>
              </div>
              <div style={{width:26,height:26,borderRadius:"50%",background:done?T.grad:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,color:"#fff",boxShadow:done?T.glowSm:""}}>{done?"âœ“":""}</div>
            </div>
          );
        })}

        <div style={{background:"#f8f8f8",borderRadius:18,padding:"16px 18px",marginTop:8}}>
          <div style={{fontSize:13,fontWeight:700,color:T.dark,marginBottom:10}}>âš–ï¸ Weight Gain Guide</div>
          {[{label:"Target gain",value:"0.1â€“0.2 kg/month",color:T.teal},{label:"No gain after 4 weeks?",value:"Add ~150 cal/day",color:"#f59e0b"},{label:"Gaining >0.3 kg/month?",value:"Reduce slightly",color:"#ef4444"}].map((row,i)=>(
            <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:i<2?"1px solid #eee":"none"}}>
              <div style={{fontSize:13,color:"#555"}}>{row.label}</div>
              <div style={{fontSize:13,fontWeight:700,color:row.color}}>{row.value}</div>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // â”€â”€ TAB BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const tabs = [
    {key:"home",icon:"ğŸ ",label:"Home"},
    {key:"nutrition",icon:"ğŸ¥—",label:"Nutrition",badge:nutDone<3&&isEvening},
    {key:"progress",icon:"ğŸ“ˆ",label:"Progress"},
  ];

  return (
    <div style={{fontFamily:"-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif",background:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",position:"relative"}}>
      {view==="home"&&<HomeView/>}
      {view==="session"&&<SessionView/>}
      {view==="nutrition"&&<NutritionView/>}
      {view==="progress"&&<ProgressView/>}
      <LogSheet/>
      <TipsSheet/>

      {/* Tab bar â€” clean white */}
      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:430,background:"rgba(255,255,255,0.95)",backdropFilter:"blur(12px)",borderTop:"1px solid #eee",display:"flex",padding:"10px 0 24px"}}>
        {tabs.map(tab=>(
          <button key={tab.key} onClick={()=>{setView(tab.key);setActiveDay(null);}}
            style={{flex:1,background:"none",border:"none",cursor:"pointer",padding:"6px 0",display:"flex",flexDirection:"column",alignItems:"center",gap:2,position:"relative"}}>
            <span style={{fontSize:20}}>{tab.icon}</span>
            {tab.badge&&<div style={{position:"absolute",top:4,right:"calc(50% - 18px)",width:8,height:8,borderRadius:"50%",background:T.teal}}/>}
            <span style={{fontSize:11,fontWeight:view===tab.key?700:400,color:view===tab.key?T.dark:"#aaa"}}>{tab.label}</span>
          </button>
        ))}
      </div>
    </div>
  );
}
